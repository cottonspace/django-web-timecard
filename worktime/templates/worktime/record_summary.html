{% extends 'worktime/base.html' %}
{% load custom_filter %}
{% load humanize %}
{% block title %}{{ year }}年{{ month }}月 | {{ block.super }}{% endblock title %}
{% block main %}
<style>
    .table tr,
    .table td {
        white-space: nowrap;
        text-align: center;
    }

    @media print {

        *,
        *::before,
        *::after {
            text-shadow: none !important;
            box-shadow: none !important;
        }

        .container {
            margin: 0;
        }

        .text-center {
            text-align: left !important;
        }

        .table-responsive {
            overflow: visible !important;
        }

        .table * {
            font-size: 12px !important;
        }

        .table tr {
            border-color: black !important;
            page-break-inside: avoid;
        }

        .table td,
        .table th {
            color: black !important;
            background-color: white !important;
            padding: 3px 8px !important;
        }

        a {
            color: black !important;
        }
    }
</style>
<div class="container text-center">
    <div class="row">
        <div class="col mb-3">
            <h2>{{ year }}年{{ month }}月</h2>
        </div>
    </div>
</div>
<div class="container no-print">
    <div class="row justify-content-center text-center">
        <div class="col mb-3">
            <div class="btn-group btn-group-sm" role="group" aria-label="Small button group">
                <button class="btn btn-outline-secondary" onclick="show_calendar(-12)">&lt; 年</button>
                <button class="btn btn-outline-secondary" onclick="show_calendar(-1)">&lt; 月</button>
                <button class="btn btn-outline-secondary" onclick="show_calendar(0)">今月</button>
                <button class="btn btn-outline-secondary" onclick="show_calendar(1)">月 &gt;</button>
                <button class="btn btn-outline-secondary" onclick="show_calendar(12)">年 &gt;</button>
            </div>
            <div class="btn-group btn-group-sm" role="group" aria-label="Small button group">
                <button class="btn btn-outline-secondary" onclick="window.print();">印刷</button>
            </div>
        </div>
    </div>
</div>
<div class="container mb-3">
    <div class="table-responsive">
        <table id="calendar" class="table table-hover table-bordered">
            <thead>
                <tr class="table-dark">
                    <th scope="col">氏名</th>
                    <th scope="col">エラー</th>
                    <th scope="col">出勤日</th>
                    <th scope="col">遅刻・早退</th>
                    <th scope="col">早出</th>
                    <th scope="col">残業</th>
                </tr>
            </thead>
            <tbody class="table-group-divider">
                {% for entry in entries %}
                <tr>
                    <th><a href="{% url 'worktime:record_calendar' %}?username={{ entry.id }}&year={{ year }}&month={{ month }}">{{ entry.name }}</a></th>
                    <td>{% if entry.summary.errors %}{{ entry.summary.errors }} 個{% else %}-{% endif %}</td>
                    <td>{% if entry.summary.work_days %}{{ entry.summary.work_days }} 日{% else %}-{% endif %}</td>
                    <td>{% if entry.summary.behind_minutes %}{{ entry.summary.behind_count }} 回 ({{ entry.summary.behind_minutes | intcomma }} 分){% else %}-{% endif %}</td>
                    <td>{% if entry.summary.early_hours %}{{ entry.summary.early_hours }} 時間 ({{ entry.summary.early_minutes | intcomma }} 分){% else %}-{% endif %}</td>
                    <td>{% if entry.summary.overtime_hours %}{{ entry.summary.overtime_hours }} 時間 ({{ entry.summary.overtime_minutes | intcomma }} 分){% else %}-{% endif %}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
<script>
    function show_calendar(delta) {
        const months = Number("{{ year }}") * 12 + (Number("{{ month }}") - 1) + delta;
        const now = new Date();
        let year, month;
        if (delta == 0) {
            year = now.getFullYear();
            month = now.getMonth();
        } else {
            year = Math.floor(months / 12);
            month = months % 12;
        }
        location.href = "{% url 'worktime:record_summary' %}?year=" + year + "&month=" + (month + 1)
    }
</script>
{% endblock main %}